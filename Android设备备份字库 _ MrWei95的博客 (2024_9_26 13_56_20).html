<!DOCTYPE html> <html lang=zh-CN><!--
 Page saved with SingleFile 
 url: https://mrwei95.github.io/2024/08/16/Backup-Flash-Memory/ 
 saved date: Thu Sep 26 2024 13:56:20 GMT+0800 (中国标准时间)
--><meta charset=utf-8>
<meta name=viewport content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv=X-UA-Compatible content="ie=edge">
<meta name=author content="Tommy Wei">
<meta name=subtitle content="Blog of Tommy Wei">
<meta name=description content="Sharing interesting things!">
<title>Android设备备份字库 | MrWei95的博客</title>
<meta name=generator content="Hexo 7.3.0"><meta name=referrer content=no-referrer><link rel=icon href=data:, data-sf-original-href=https://mrwei95.github.io/95_Logo.ico><link rel=canonical href=https://mrwei95.github.io/2024/08/16/Backup-Flash-Memory/><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:; frame-src 'self' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
<body>
 
 <div class=wrapper>
 <header>
 <nav class=navbar>
 <div class=container>
 <div class="navbar-header header-logo"><a href=https://mrwei95.github.io/>博客主页</a></div>
 <div class="menu navbar-right">
 
 <a class=menu-item href=https://mrwei95.github.io/archives>归档</a>
 
 <a class=menu-item href=https://mrwei95.github.io/category>分类</a>
 
 <a class=menu-item href=https://mrwei95.github.io/tag>标签</a>
 
 <a class=menu-item href=https://mrwei95.github.io/about>关于</a>
 
 <input id=switch_default type=checkbox class=switch_default>
 <label for=switch_default class=toggleBtn></label>
 </div>
 </div>
 </nav>
 
 <nav class=navbar-mobile id=nav-mobile>
 <div class=container>
 <div class=navbar-header>
 <div>
 <a href=https://mrwei95.github.io/>博客主页</a><a id=mobile-toggle-theme>·&nbsp;Light</a>
 </div>
 <div class=menu-toggle>☰ Menu</div>
 </div>
 <div class=menu id=mobile-menu>
 
 <a class=menu-item href=https://mrwei95.github.io/archives>归档</a>
 
 <a class=menu-item href=https://mrwei95.github.io/category>分类</a>
 
 <a class=menu-item href=https://mrwei95.github.io/tag>标签</a>
 
 <a class=menu-item href=https://mrwei95.github.io/about>关于</a>
 
 </div>
 </div>
 </nav>
</header>
 <div class=main>
 <div class=container>
 
 
 <div class=post-toc>
 <div class=tocbot-list>
 </div>
 <div class=tocbot-list-menu>
 <a class=tocbot-toc-expand>Expand all</a>
 <a>Back to top</a>
 <a>Go to bottom</a>
 </div>
</div>
 
 
 <article class=post-wrap>
 <header class=post-header>
 <h1 class=post-title>Android设备备份字库</h1>
 
 <div class=post-meta>
 
 Author: <a itemprop=author rel=author href=https://mrwei95.github.io/>Tommy Wei</a>
 
 
 <span class=post-time>
 Date: <a href=#>2024 八月 16&nbsp;&nbsp;13:26:54</a>
 </span>
 
 
 <span class=post-category>
 Category:
 
 <a href=https://mrwei95.github.io/categories/Android-Blog/>Android Blog</a>
 
 </span>
 
 </div>
 
 </header>
 <div class=post-content>
 <p><font face=微软雅黑 size=4></font></p>
<p><font face=微软雅黑 size=4>本文将带你学会如何备份Android设备的字库文件(包含基带)。</font><br><font face=微软雅黑 size=4>如需观看视频教程可跳转<a target=_blank rel=noopener href=https://www.bilibili.com/video/BV1bje8eVEjK/>本人视频</a>。</font></p>
<h2 id=一、什么是字库，为什么要备份字库？><a href=#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%AD%97%E5%BA%93%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%A4%87%E4%BB%BD%E5%AD%97%E5%BA%93%EF%BC%9F class=headerlink title=一、什么是字库，为什么要备份字库？></a><font face=微软雅黑>一、什么是字库，为什么要备份字库？</font></h2><p><font face=微软雅黑 size=4>字库可以简单理解为Android设备的分区。刷机时也会刷入分区，但刷入不完整。如果设备刚好是其他分区损坏了，那么即使线刷完整包也无法修复。所以为了预防特殊分区损坏、也为了预防不小心刷入格机模块(rm -rf /)，玩机前我们需要自行备份Android设备的字库文件。</font></p>
<h2 id=二、备份的前提条件><a href=#%E4%BA%8C%E3%80%81%E5%A4%87%E4%BB%BD%E7%9A%84%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6 class=headerlink title=二、备份的前提条件></a><font face=微软雅黑>二、备份的前提条件</font></h2><h3 id=·-设备需获取Root权限><a href=#%C2%B7-%E8%AE%BE%E5%A4%87%E9%9C%80%E8%8E%B7%E5%8F%96Root%E6%9D%83%E9%99%90 class=headerlink title="· 设备需获取Root权限"></a><font face=微软雅黑>· 设备需获取Root权限</font></h3><p><font face=微软雅黑 size=4>我选择使用Magisk获取Root权限，获取方式参考<a target=_blank rel=noopener href=http://www.bilibili.com/video/BV17aY9e4E9o/>我的视频</a>。当然，如果你没有获取Root权限，或者说连Bootloader锁都没有解开，那也没有必要备份字库，正常用就行，多一事不如少一事。</font></p>
<h3 id=·-开启设备的USB调试><a href=#%C2%B7-%E5%BC%80%E5%90%AF%E8%AE%BE%E5%A4%87%E7%9A%84USB%E8%B0%83%E8%AF%95 class=headerlink title="· 开启设备的USB调试"></a><font face=微软雅黑>· 开启设备的USB调试</font></h3><p><font face=微软雅黑 size=4>在开发者选项中打开。</font></p>
<h3 id=·-给予Shell以Root权限><a href=#%C2%B7-%E7%BB%99%E4%BA%88Shell%E4%BB%A5Root%E6%9D%83%E9%99%90 class=headerlink title="· 给予Shell以Root权限"></a><font face=微软雅黑>· 给予Shell以Root权限</font></h3><p><font face=微软雅黑 size=4> 将设备连接至电脑，在终端进入adb shell(需提前拥有platform-tools，如何安装参考<a target=_blank rel=noopener href=http://www.bilibili.com/video/BV1KJ4m1u7or/>我的视频中安装驱动部分</a>。首次使用设备会提示“是否给予Root权限”，给予即可。指令如下：</font></p>
<figure class="highlight shell"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>adb shell</span><br><span class=line>su</span><br></pre></table></figure>
<h3 id=·-在Android至少预留20GB可用空间><a href=#%C2%B7-%E5%9C%A8Android%E8%87%B3%E5%B0%91%E9%A2%84%E7%95%9920GB%E5%8F%AF%E7%94%A8%E7%A9%BA%E9%97%B4 class=headerlink title="· 在Android至少预留20GB可用空间"></a><font face=微软雅黑>· 在Android至少预留20GB可用空间</font></h3><p><font face=微软雅黑 size=4>现代Android设备分区很多，占用空间也很大，本人的小米平板6(pipa)备份文件大约十几GB。</font></p>
<h2 id=三、备份字库><a href=#%E4%B8%89%E3%80%81%E5%A4%87%E4%BB%BD%E5%AD%97%E5%BA%93 class=headerlink title=三、备份字库></a><font face=微软雅黑>三、备份字库</font></h2><p><font face=微软雅黑 size=3 color=#FF000>本文使用的方法是手动在Shell中键入指令以达成备份字库的目的，酷安上有教程可在手机上直接执行备份和恢复，写的很好，但本人认为恢复部分有些许问题，因此不采用这种方法。缘由我已经在视频里说了，所以不要再在我视频评论区里说什么“XXX直接秒”之类的了，等你需要恢复字库的时候手机屏幕都不一定亮得起来。</font></p>
<h3 id=·-创建工作目录><a href=#%C2%B7-%E5%88%9B%E5%BB%BA%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95 class=headerlink title="· 创建工作目录"></a><font face=微软雅黑>· 创建工作目录</font></h3><p><font face=微软雅黑 size=4>首先，我们在设备sdcard目录下创建一个用于存储备份字库的目录：</font></p>
<figure class="highlight shell"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>mkdir /sdcard/000_Backup</span><br></pre></table></figure>
<p><font face=微软雅黑 size=4>这个时候我们就可以在设备的文件浏览器看到了。</font></p>
<h3 id=·-读取设备的分区信息><a href=#%C2%B7-%E8%AF%BB%E5%8F%96%E8%AE%BE%E5%A4%87%E7%9A%84%E5%88%86%E5%8C%BA%E4%BF%A1%E6%81%AF class=headerlink title="· 读取设备的分区信息"></a><font face=微软雅黑>· 读取设备的分区信息</font></h3><p><font face=微软雅黑 size=4>在终端中输入以下命令，这里注意，我的指令中屏蔽了userdata和缓存分区(没有必要)。</font></p>
<figure class="highlight shell"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>ls -1 /dev/block/bootdevice/by-name | grep -ixvE "userdata|cache" | while IFS= read -r name; do echo "dd if=/dev/block/bootdevice/by-name/$name of=/sdcard/000_Backup/$name.img" &gt;&gt; /sdcard/000_Backup/001_Backup.sh; echo "fastboot flash $name $name.img" &gt;&gt; /sdcard/000_Backup/002_Restore.bat; done</span><br></pre></table></figure>
<p><font face=微软雅黑 size=4>执行完成后，000_Backup目录下会多出一个sh脚本和一个bat脚本，sh脚本用于读取备份，bat用于还原备份。</font></p>
<h3 id=·-执行备份脚本><a href=#%C2%B7-%E6%89%A7%E8%A1%8C%E5%A4%87%E4%BB%BD%E8%84%9A%E6%9C%AC class=headerlink title="· 执行备份脚本"></a><font face=微软雅黑>· 执行备份脚本</font></h3><p><font face=微软雅黑 size=4>我们使用001_Backup.sh脚本执行备份：</font></p>
<figure class="highlight shell"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>sh /sdcard/000_Backup/001_Backup.sh</span><br></pre></table></figure>
<p><font face=微软雅黑 size=4>随后终端会显示备份的进度，耐心等待。</font></p>
<h3 id=·-创建MD5值表（可不看）><a href=#%C2%B7-%E5%88%9B%E5%BB%BAMD5%E5%80%BC%E8%A1%A8%EF%BC%88%E5%8F%AF%E4%B8%8D%E7%9C%8B%EF%BC%89 class=headerlink title="· 创建MD5值表（可不看）"></a><font face=微软雅黑>· 创建MD5值表（可不看）</font></h3><p><font face=微软雅黑 size=4>备份完成后我们执行下面这条命令，它会计算我们备份出来的所有文件的MD5值并将其全部整理至003_MD5Hsah.txt这个文本中。</font></p>
<figure class="highlight shell"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>cd /sdcard/000_Backup &amp;&amp; md5sum * &gt; /sdcard/000_Backup/003_MD5Hsah.txt</span><br></pre></table></figure>
<p><font face=微软雅黑 size=4>备份MD5值是为了防止在存储过程中备份文件出现损坏，而我们浑然不知，将这个损坏的分区刷进手机导致出错。</font></p>
<p><font face=微软雅黑 size=4>到这里基础备份工作就完成了！</font></p>
<h2 id=四、修改bat脚本（可不看）><a href=#%E5%9B%9B%E3%80%81%E4%BF%AE%E6%94%B9bat%E8%84%9A%E6%9C%AC%EF%BC%88%E5%8F%AF%E4%B8%8D%E7%9C%8B%EF%BC%89 class=headerlink title=四、修改bat脚本（可不看）></a><font face=微软雅黑>四、修改bat脚本（可不看）</font></h2><p><font face=微软雅黑 size=4>我们备份字库的目的就是还原那些刷机包中没有的分区文件，如果刷机包中包含某些文件，我们就没有必要还原，不然可能会导致版本冲突，并且浪费时间。我们可以修改bat脚本中的指令，使还原的时候不会恢复super等分区</font></p>
<figure class="highlight shell"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>sed -i -e '/ super.img/s/^/::/g' -e '/ system.img/s/^/::/g' -e '/ system_a.img/s/^/::/g' -e '/ system_b.img/s/^/::/g' -e '/ vendor.img/s/^/::/g' -e '/ vendor_a.img/s/^/::/g' -e '/ vendor_b.img/s/^/::/g' -e '/ mmcblk0.img/s/^/::/g' -e '/ sda.img/s/^/::/g' -e '/ sdb.img/s/^/::/g' -e '/ sdc.img/s/^/::/g' -e '/ sdd.img/s/^/::/g' -e '/ sde.img/s/^/::/g' -e '/ sdf.img/s/^/::/g' -e '/ sdg.img/s/^/::/g' /sdcard/000_Backup/002_Restore.bat</span><br></pre></table></figure>
<p><font face=微软雅黑 size=4>然后我们给它打包一下，在sdcard根目录下就可以看到PartitionBackup.tgz了。</font></p>
<figure class="highlight shell"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>cd /sdcard &amp;&amp; tar -zcpvf PartitionBackup.tgz 000_Backup</span><br></pre></table></figure>
<p><font face=微软雅黑 size=4>我们将tgz压缩文件备份至电脑端，以后要用直接解压就很方便了。这时我们就可以删除设备存储中的000_Backup目录，释放空间。以后需要还原的时候我们只需要解压目录，将手机启动至Fastboot模式，在终端执行bat脚本即可。</font><br><font face=微软雅黑 size=4></font><br><font face=微软雅黑 size=4></font><br><font face=微软雅黑 size=4></font><br><font face=微软雅黑 size=5 color=#FF000>备份分区列表的部分暂未更新！</font></p>
 </div>
 
 <section class=post-copyright>
 
 <p class=copyright-item>
 <span>Author:</span>
 <span>Tommy Wei</span>
 </p>
 
 
 <p class=copyright-item>
 <span>Permalink:</span>
 <span><a href=https://mrwei95.github.io/2024/08/16/Backup-Flash-Memory/>https://mrwei95.github.io/2024/08/16/Backup-Flash-Memory/</a></span>
 </p>
 
 
 <p class=copyright-item>
 <span>License:</span>
 <span>Copyright (c) 2019 <a target=_blank rel=noopener href=http://creativecommons.org/licenses/by-nc/4.0/>CC-BY-NC-4.0</a> LICENSE</span>
 </p>
 
 
 
 
<span class=site-pv>
 Views:
 <i class=busuanzi-value id=busuanzi_value_site_pv></i>
</span>
 
 
 
 </section>
 
 <section class=post-tags>
 <div>
 <span>Tag(s):</span>
 <span class=tag>
 
 
 <a href=https://mrwei95.github.io/tags/Android/># Android</a>
 
 
 </span>
 </div>
 <div>
 <a href=javascript:void(0)>back</a>
 <span>· </span>
 <a href=https://mrwei95.github.io/>home</a>
 </div>
 </section>
 <section class=post-nav>
 
 <a class=prev rel=prev href=https://mrwei95.github.io/2024/09/02/L298N-USE/>L298N电机驱动模块</a>
 
 
 <a class=next rel=next href=https://mrwei95.github.io/2024/08/15/hello-world/>First Step!</a>
 
 </section>
 </article>
</div>
 </div>
 <footer id=footer class=footer>
 <div class=copyright>
 <span>© 2024 Tommy Wei | Powered by <a href=https://hexo.io/ target=_blank>Hexo</a> &amp; <a href=https://github.com/Siricee/hexo-theme-Chic target=_blank>Chic</a></span>
 </div>
</footer>
 </div>
<script data-template-shadow-root>(()=>{document.currentScript.remove();processNode(document);function processNode(node){node.querySelectorAll("template[shadowrootmode]").forEach(element=>{let shadowRoot = element.parentElement.shadowRoot;if (!shadowRoot) {try {shadowRoot=element.parentElement.attachShadow({mode:element.getAttribute("shadowrootmode"),delegatesFocus:element.getAttribute("shadowrootdelegatesfocus")!=null,clonable:element.getAttribute("shadowrootclonable")!=null,serializable:element.getAttribute("shadowrootserializable")!=null});shadowRoot.innerHTML=element.innerHTML;element.remove()} catch (error) {} if (shadowRoot) {processNode(shadowRoot)}}})}})()</script>